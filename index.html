<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Imsakiah - Musholla Raudhatul Jannah</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
            background-color: #ffffff;
            color: #1f2937;
        }
        .font-heavy { font-weight: 900; letter-spacing: -0.02em; }
        .hero-section {
            background-image: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%), url('background.jpg');
            background-size: cover;
            background-position: center;
            height: 480px;
        }
        .card-soft-shadow { box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.06); }
        .green-glow-shadow { box-shadow: -10px 0 30px rgba(0,0,0,0.1), 0 20px 40px -10px rgba(0, 255, 94, 0.5); }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <div class="hero-section relative w-full">
        <div class="max-w-5xl mx-auto px-10 md:px-14 pt-16">
            <h1 class="text-6xl text-white font-heavy leading-[1.1] drop-shadow-lg">
                Jadwal<br>Imsakiah
            </h1>
        </div>
    </div>

    <div class="px-10 md:px-14 -mt-56 relative z-10 mb-16">
        <div class="max-w-5xl mx-auto">
            <div class="bg-[#333b46] rounded-[3rem] shadow-2xl flex flex-col md:flex-row min-h-[320px] relative">
                
                <div class="w-full md:w-1/2 p-10 flex flex-col justify-between text-white">
                    <div class="flex items-center justify-between bg-white/10 rounded-full p-1 mb-8">
                        <button onclick="ubahHari(-1)" class="p-2 hover:bg-white/10 rounded-full transition">
                            <img src="icon-previous.svg" class="w-5 h-5 invert" alt="Prev">
                        </button>
                        <span class="font-heavy text-sm tracking-wide">Hari <span id="display-hari">Ahad</span></span>
                        <button onclick="ubahHari(1)" class="p-2 hover:bg-white/10 rounded-full transition">
                            <img src="icon-next.svg" class="w-5 h-5 invert" alt="Next">
                        </button>
                    </div>

                    <div class="mb-6">
                        <div id="display-hijri" class="text-3xl font-bold mb-1 tracking-tight">-- --- 14-- H</div>
                        <div id="display-masehi" class="text-xl opacity-70">-- --- 20-- M</div>
                    </div>

                    <div class="h-px w-full bg-white/10 my-6"></div>

                    <div class="flex items-start gap-3">
                        <img src="icon-location.svg" class="w-5 h-5 mt-1 invert opacity-70" alt="Loc">
                        <p id="display-lokasi" class="text-sm font-medium opacity-80 leading-relaxed">Mendeteksi lokasi...</p>
                    </div>
                </div>

                <div class="w-full md:w-1/2 bg-[#16a34a] text-white p-10 flex flex-col justify-center items-center text-center
                            rounded-t-[3rem] rounded-b-[3rem] md:rounded-l-[3rem] md:rounded-r-[3rem] green-glow-shadow">
                    <p class="text-sm font-bold tracking-wide opacity-90 mb-3">Waktu Terdekat</p>
                    <h2 id="next-pray-name" class="text-5xl font-heavy uppercase mb-2">--</h2>
                    <div id="next-pray-time" class="text-8xl font-heavy tracking-tighter mb-8">--:--</div>
                    <div>
                        <span id="countdown" class="inline-block bg-black/20 px-8 py-3 rounded-full font-mono text-2xl font-bold border border-white/10 backdrop-blur-sm">
                            -00:00:00
                        </span>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto px-10 md:px-14 pb-16 w-full">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <script>
                const pList = ['Imsak', 'Subuh', 'Terbit', 'Duha', 'Zuhur', 'Asar', 'Magrib', 'Isya'];
                pList.forEach(p => {
                    document.write(`
                        <div id="card-${p}" class="card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border border-gray-50 transition-all duration-500">
                            <img src="icon-${p.toLowerCase()}.svg" id="icon-${p}" class="w-10 h-10 mb-5 opacity-20" alt="${p}">
                            <span class="text-[10px] font-heavy text-gray-400 uppercase tracking-[0.2em] label mb-2">${p}</span>
                            <span class="text-3xl font-heavy text-gray-700 time tracking-tight" id="v-${p}">--:--</span>
                        </div>
                    `);
                });
            </script>
        </div>
        <p class="text-[10px] text-gray-400 mt-8 text-center italic">
            Sumber: <a href="https://bimasislam.kemenag.go.id/jadwalshalat" target="_blank" class="hover:text-green-600">Direktorat Jenderal Bimbingan Masyarakat Islam Kementerian Agama Republik Indonesia</a>
        </p>
    </div>

    <div class="bg-[#16a34a] w-full py-16 px-10 text-center mt-auto">
        <div class="max-w-4xl mx-auto">
            <img src="QS An-Nisa 103.png" alt="Kaligrafi" class="h-16 mx-auto mb-8 brightness-0 invert opacity-90 object-contain">
            <p class="text-white text-xl italic font-medium leading-relaxed max-w-2xl mx-auto">
                "Sesungguhnya salat itu adalah fardu yang ditentukan waktunya atas orang-orang yang beriman."
            </p>
            <p class="text-white/80 text-sm mt-4 font-bold tracking-wide">(QS. An-Nisa' [4]: 103)</p>
        </div>
    </div>

    <div class="bg-[#333b46] text-white py-16 px-10 md:px-14">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-12">
            
            <div class="flex flex-col md:flex-row items-center gap-8">
                <img src="logo.svg" class="w-24 h-24 brightness-0 invert object-contain" alt="Logo">
                <div class="text-center md:text-left">
                    <h3 class="font-heavy text-xl tracking-wide mb-2">Musholla Raudhatul Jannah</h3>
                    <a href="https://maps.app.goo.gl/7QFZ1CJjUiJLDudq9?g_st=ic" target="_blank" class="text-xs text-gray-400 leading-relaxed font-medium hover:text-white transition-colors">
                        Perumahan Grand Permata Tembalang<br>
                        Kelurahan Rowosari, Kecamatan Tembalang,<br>
                        Kota Semarang, Jawa Tengah 50279
                    </a>
                </div>
            </div>

            <div class="flex flex-col gap-6">
                <div class="flex items-center gap-6 bg-white/5 p-6 rounded-[2.5rem] border border-white/5">
                    <div class="text-right">
                        <p class="text-[11px] text-gray-400 tracking-wider mb-1">Informasi Seputar</p>
                        <p class="text-base font-bold text-white leading-tight">Infaq dan Sedekah<br>Silakan klik:</p>
                    </div>
                    <a href="https://wa.me/6289660304009?text=BTPN%20SYARIAH%20%28547%29%0A1023862413%0AWILDAN%20BACHTIAR" target="_blank" class="bg-white p-2 rounded-2xl w-24 h-24 hover:scale-105 transition-transform flex items-center justify-center shadow-xl">
                        <img src="qr-code.svg" class="w-full h-full" alt="QR">
                    </a>
                </div>

                <div class="flex flex-col gap-3 px-2">
                    <a href="https://docs.google.com/spreadsheets/d/1Zjk4UNAZi_My_kTvD5QbPO7LS47p6Y_L3ppK_tRyEfc/edit?usp=sharing" target="_blank" class="group flex items-center gap-3 text-xs text-gray-400 hover:text-white transition-colors">
                        <span class="text-green-500 group-hover:translate-x-1 transition-transform">➤</span>
                        <span class="border-b border-transparent group-hover:border-gray-500">Laporan Keuangan Musholla</span>
                    </a>
                    <a href="https://renovasimushollagpt.my.canva.site/" target="_blank" class="group flex items-center gap-3 text-xs text-gray-400 hover:text-white transition-colors">
                        <span class="text-green-500 group-hover:translate-x-1 transition-transform">➤</span>
                        <span class="border-b border-transparent group-hover:border-gray-500">Laporan Keuangan Renovasi Musholla</span>
                    </a>
                </div>
            </div>

        </div>
    </div>

<script>
        let viewDate = new Date(); 
        let userRegion = "semarang"; 
        const API_KEY = "Ge4Hhs4R0asczqlYJ5Pd7RlefsVQR2BqZzxTNrwWp5Q7RG0pbm"; 
        let todayTimings = null, tomorrowTimings = null;
        let intervalId = null;

        const bulanHijriahKBBI = {
            "Muḥarram": "Muharam", "Ṣafar": "Safar", "Rabīʿ al-awwal": "Rabiulawal", 
            "Rabīʿ al-thānī": "Rabiulakhir", "Jumādá al-ūlá": "Jumadilawal", 
            "Jumādá al-ākhirah": "Jumadilakhir", "Rajab": "Rajab", "Shaʿbān": "Syakban", 
            "Ramaḍān": "Ramadan", "Shawwāl": "Syawal", "Dhū al-Qaʿdah": "Zulkaidah", "Dhū al-Ḥijjah": "Zulhijah"
        };
        const namaHariMap = ["Ahad", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

        function ubahHari(n) {
            viewDate.setDate(viewDate.getDate() + n);
            fetchJadwal();
        }

        function resetCardStyle(k) {
            const c = document.getElementById(`card-${k}`);
            if(!c) return;
            c.className = "card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border border-gray-50 transition-all duration-500";
            const ic = document.getElementById(`icon-${k}`);
            ic.style.filter = "none";
            ic.className = "w-10 h-10 mb-5 opacity-20";
            c.querySelector('.label').className = "text-[10px] font-heavy text-gray-400 uppercase tracking-[0.2em] label mb-2";
            c.querySelector('.time').className = "text-3xl font-heavy text-gray-700 time tracking-tight";
        }

        async function fetchJadwal() {
            const yyyy = viewDate.getFullYear();
            const mm = String(viewDate.getMonth() + 1).padStart(2, '0');
            const dd = String(viewDate.getDate()).padStart(2, '0');
            const dateString = `${yyyy}-${mm}-${dd}`;

            try {
                // Mengambil data jadwal dari server regional Indonesia
                const response = await fetch(`https://use.api.co.id/regional/indonesia/prayer-times?region=${userRegion}&date=${dateString}`);
                const result = await response.json();

                if (result.status) {
                    const t = result.data;
                    document.getElementById('display-hari').innerText = namaHariMap[viewDate.getDay()];
                    document.getElementById('display-masehi').innerText = viewDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) + " M";

                    // Mengambil informasi kalender Hijriah
                    fetch(`https://api.aladhan.com/v1/gToH/${dd}-${mm}-${yyyy}`).then(r => r.json()).then(hData => {
                        const h = hData.data.hijri;
                        const namaBulanApi = h.month.en;
                        document.getElementById('display-hijri').innerText = `${h.day} ${bulanHijriahKBBI[namaBulanApi] || namaBulanApi} ${h.year} H`;
                    });

                    const apiMap = { 
                        'Imsak': t.imsak, 'Subuh': t.fajr, 'Terbit': t.sunrise, 'Duha': t.dhuha, 
                        'Zuhur': t.dhuhr, 'Asar': t.asr, 'Magrib': t.maghrib, 'Isya': t.isha 
                    };

                    const list = ['Imsak', 'Subuh', 'Terbit', 'Duha', 'Zuhur', 'Asar', 'Magrib', 'Isya'];
                    list.forEach(k => {
                        document.getElementById(`v-${k}`).innerText = apiMap[k];
                        resetCardStyle(k);
                    });

                    // Memperbarui sistem hitung mundur jika menampilkan hari ini
                    if (viewDate.toDateString() === new Date().toDateString()) {
                        todayTimings = apiMap;
                        let tmrw = new Date(); tmrw.setDate(tmrw.getDate() + 1);
                        const tmrwStr = tmrw.toISOString().split('T')[0];
                        fetch(`https://use.api.co.id/regional/indonesia/prayer-times?region=${userRegion}&date=${tmrwStr}`)
                            .then(r => r.json()).then(res => {
                                tomorrowTimings = { 'Imsak': res.data.imsak };
                                initRealtimeCountdown();
                            });
                    }
                }
            } catch (error) { console.error("Proses pengambilan data terhenti."); }
        }

        function initRealtimeCountdown() {
            if (intervalId) clearInterval(intervalId);
            intervalId = setInterval(() => {
                if (!todayTimings) return;
                const now = new Date();
                const times = [
                    { name: 'Imsak', time: todayTimings['Imsak'] },
                    { name: 'Subuh', time: todayTimings['Subuh'] },
                    { name: 'Zuhur', time: todayTimings['Zuhur'] },
                    { name: 'Asar', time: todayTimings['Asar'] },
                    { name: 'Magrib', time: todayTimings['Magrib'] },
                    { name: 'Isya', time: todayTimings['Isya'] }
                ];

                let next = null;
                for (let p of times) {
                    let pt = new Date(); let [h, m] = p.time.split(':'); pt.setHours(h, m, 0);
                    if (pt > now) { next = { ...p, obj: pt }; break; }
                }

                if (!next && tomorrowTimings) {
                    let pt = new Date(); pt.setDate(pt.getDate()+1);
                    let [h, m] = tomorrowTimings['Imsak'].split(':'); pt.setHours(h, m, 0);
                    next = { name: 'Imsak', time: tomorrowTimings['Imsak'], obj: pt };
                }

                if (next) {
                    document.getElementById('next-pray-name').innerText = next.name;
                    document.getElementById('next-pray-time').innerText = next.time;
                    let diff = next.obj - now;
                    let hh = Math.floor(diff / 3600000); let mm = Math.floor((diff % 3600000) / 60000); let ss = Math.floor((diff % 60000) / 1000);
                    document.getElementById('countdown').innerText = `-${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
                    
                    // Menandai jadwal aktif pada tabel jika menampilkan waktu hari ini
                    if (viewDate.toDateString() === new Date().toDateString()) {
                        const active = document.getElementById(`card-${next.name}`);
                        if(active) {
                            active.className = "card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border-2 border-green-500 shadow-xl scale-[1.05] z-20";
                            active.querySelector('.label').className = "text-[10px] font-heavy text-green-600 uppercase tracking-[0.2em] label mb-2";
                            active.querySelector('.time').className = "text-3xl font-heavy text-green-600 time tracking-tight";
                            const ic = document.getElementById(`icon-${next.name}`);
                            ic.className = "w-10 h-10 mb-5 opacity-100";
                            ic.style.filter = "invert(40%) sepia(87%) saturate(1518%) hue-rotate(117deg) brightness(93%) contrast(85%)";
                        }
                    }
                }
            }, 1000);
        }

        // Memulai deteksi lokasi pengunjung
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(p => {
                const lat = p.coords.latitude;
                const lon = p.coords.longitude;
                // Sinkronisasi koordinat dengan data wilayah Indonesia
                fetch(`https://us1.locationiq.com/v1/reverse.php?key=${API_KEY}&lat=${lat}&lon=${lon}&format=json`)
                    .then(r => r.json()).then(d => {
                        const addr = d.address;
                        const city = addr.city || addr.town || addr.city_district || addr.county || "jakarta";
                        userRegion = city.toLowerCase().replace("kota ", "").replace("kabupaten ", "").trim();
                        document.getElementById('display-lokasi').innerText = `${city}, ${addr.state || ''}`;
                        fetchJadwal();
                    })
                    .catch(() => fetchJadwal());
            }, () => {
                // Penanganan jika akses lokasi tidak diizinkan
                document.getElementById('display-lokasi').innerText = "Jakarta (Lokasi Default)";
                fetchJadwal();
            });
        } else { fetchJadwal(); }
    </script>
</body>
</html>