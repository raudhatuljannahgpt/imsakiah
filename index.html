<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Jadwal Imsakiah untuk seluruh wilayah Indonesia. Pantau waktu imsak, terbit, duha, dan salat lima waktu setiap hari di sini.">
    <title>Jadwal Imsakiah - Musholla Raudhatul Jannah</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="preload" as="image" href="background.webp">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Inter", sans-serif;
            background-color: #ffffff;
            color: #1f2937;
            overflow-x: hidden;
        }
        .font-heavy { font-weight: 900; letter-spacing: -0.02em; }
        .hero-section {
            position: relative;
            height: 530px;
            overflow: hidden;
            background-color: #000;
        }
        #parallax-bg {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 110%;
            background-image: linear-gradient(180deg, rgba(0,0,0,0.1) 0%, rgba(0,0,0,0.4) 100%), url('background.webp');
            background-size: cover;
            background-position: center;
            will-change: transform;
            transform: scale(1.05);
        }
        .card-soft-shadow { box-shadow: 0 15px 35px -5px rgba(0, 0, 0, 0.06); }
        .green-glow-shadow { box-shadow: -10px 0 30px rgba(0,0,0,0.1), 0 20px 40px -10px rgba(0, 255, 94, 0.5); }
        img {
            -webkit-user-drag: none;
            user-select: none;
            -moz-user-select: none;
            -khtml-user-drag: none;
            -o-user-drag: none;
        }
    </style>
</head>
<body oncontextmenu="return false" class="flex flex-col min-h-screen">

    <div id="toast-container" class="fixed top-6 left-1/2 -translate-x-1/2 z-[100] flex flex-col gap-3 w-[90%] max-w-sm"></div>

    <div id="sticky-header" class="fixed top-0 left-0 w-full bg-white z-50 transform -translate-y-full transition-transform duration-500 shadow-[0_2px_15px_-3px_rgba(0,0,0,0.07)] border-b border-gray-50">
        <div class="max-w-5xl mx-auto px-10 md:px-14 h-20 flex items-center justify-between">
            <div class="flex flex-col">
                <span class="text-xs font-bold text-gray-400 leading-tight">Jadwal</span>
                <span class="text-xl font-heavy text-gray-600 leading-tight">Imsakiah</span>
            </div>
            <div class="text-right">
                <div id="sticky-realtime-info" class="text-xs font-bold text-gray-500 mb-1 tracking-tight">-- --- 14-- H</div>
                <div class="flex items-center justify-end gap-1.5 text-green-600 font-bold">
                    <img src="icon-location.svg" class="w-3.5 h-3.5" style="filter: invert(40%) sepia(87%) saturate(1518%) hue-rotate(117deg) brightness(93%) contrast(85%);" alt="loc">
                    <span id="sticky-location" class="text-[11px] tracking-wider capitalize">Mendeteksi...</span>
                </div>
            </div>
        </div>
    </div>

    <div class="hero-section">
        <div id="parallax-bg"></div> 
    
        <div class="max-w-5xl mx-auto px-10 md:px-14 pt-16 relative z-10">
            <h1 class="text-6xl text-white font-heavy leading-[1.1] drop-shadow-lg">Jadwal<br>Imsakiah</h1>
        </div>
    </div>

    <div class="px-10 md:px-14 -mt-64 relative z-10 mb-16">
        <div class="max-w-5xl mx-auto">
            <div class="bg-[#333b46]/80 backdrop-blur-md rounded-[3rem] shadow-2xl flex flex-col md:flex-row min-h-[320px] relative border border-white/5">
                <div class="w-full md:w-1/2 p-10 flex flex-col justify-between text-white">
                    <div class="flex items-center justify-between bg-white/10 rounded-full p-1 mb-8">
                        <button onclick="ubahHari(-1)" aria-label="Hari Sebelumnya" class="p-2 hover:bg-white/10 rounded-full transition"><img src="icon-previous.svg" class="w-5 h-5 invert" alt="Prev"></button>
                        <span class="font-heavy text-sm tracking-wide">Hari <span id="display-hari">Ahad</span></span>
                        <button onclick="ubahHari(1)" aria-label="Hari Berikutnya" class="p-2 hover:bg-white/10 rounded-full transition"><img src="icon-next.svg" class="w-5 h-5 invert" alt="Next"></button>
                    </div>
                    <div class="mb-6">
                        <div id="display-hijri" class="text-3xl font-bold mb-1 tracking-tight">-- --- 14-- H</div>
                        <div id="display-masehi" class="text-xl opacity-70">-- --- 20-- M</div>
                    </div>
                    <div class="h-px w-full bg-white/10 my-6"></div>
                    <div class="flex items-center justify-between w-full mt-6">
                        <div class="flex items-start gap-3">
                            <img src="icon-location.svg" class="w-5 h-5 mt-0.5 invert opacity-70" alt="Loc">
                            <p id="display-lokasi" class="text-sm font-medium opacity-80 leading-relaxed capitalize">Mendeteksi lokasi...</p>
                        </div>
                        <button onclick="bukaModalLokasi()" class="text-[12px] font-bold border border-white/20 px-3 py-1.5 rounded-full hover:bg-white/10 transition-all shrink-0">
                            Ubah Lokasi
                        </button>
                    </div>
                </div>
                <div class="w-full md:w-1/2 bg-[#16a34a] text-white p-10 flex flex-col justify-center items-center text-center rounded-t-[3rem] rounded-b-[3rem] md:rounded-l-[3rem] md:rounded-r-[3rem] green-glow-shadow">
                    <p class="text-sm font-bold tracking-wide opacity-90 mb-3">Waktu Terdekat</p>
                    <h2 id="next-pray-name" class="text-5xl font-heavy uppercase mb-2">--</h2>
                    <div id="next-pray-time" class="text-8xl font-heavy tracking-tighter mb-8">--:--</div>
                    <div>
                        <span id="countdown" class="inline-block bg-black/20 px-8 py-3 rounded-full font-mono text-2xl font-bold border border-white/10 backdrop-blur-sm">-00:00:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-5xl mx-auto px-10 md:px-14 pb-16 w-full">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
            <script>
                const pList = ['Imsak', 'Subuh', 'Terbit', 'Duha', 'Zuhur', 'Asar', 'Magrib', 'Isya'];
                pList.forEach(p => {
                    document.write(`
                        <div id="card-${p}" class="card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border border-gray-50 transition-all duration-500">
                            <img src="icon-${p.toLowerCase()}.svg" id="icon-${p}" class="w-10 h-10 mb-5 opacity-20" alt="${p}">
                            <span class="text-[10px] font-heavy text-gray-400 uppercase tracking-[0.2em] label mb-2">${p}</span>
                            <span class="text-3xl font-heavy text-gray-700 time tracking-tight" id="v-${p}">--:--</span>
                        </div>
                    `);
                });
            </script>
        </div>
        <p class="text-[10px] text-gray-600 mt-14 text-center italic">
            Selengkapnya lihat di: <a href="https://bimasislam.kemenag.go.id/jadwalshalat" target="_blank" class="hover:text-green-600">Direktorat Jenderal Bimbingan Masyarakat Islam Kementerian Agama Republik Indonesia</a>
        </p>
    </div>

    <div class="bg-[#16a34a] w-full py-16 px-10 text-center mt-auto">
        <div class="max-w-4xl mx-auto">
            <img src="QS An-Nisa 103.webp" alt="إِنَّ ٱلصَّلَوٰةَ كَانَتْ عَلَى ٱلْمُؤْمِنِينَ كِتَٰبٗا مَّوْقُوتٗا" class="h-16 mx-auto mb-8 brightness-0 invert opacity-90 object-contain">
            <p class="text-white text-xl italic font-medium leading-relaxed max-w-2xl mx-auto">
                "Sesungguhnya salat itu adalah fardu yang ditentukan waktunya atas orang-orang yang beriman."
            </p>
            <p class="text-white/80 text-sm mt-4 font-bold tracking-wide">(QS. An-Nisa' [4]: 103)</p>
        </div>
    </div>

    <div class="bg-[#333b46] text-white py-16 px-10 md:px-14">
        <div class="max-w-5xl mx-auto flex flex-col md:flex-row justify-between items-center gap-12">
            <div class="flex flex-col md:flex-row items-center gap-8">
                <img src="logo.svg" class="w-24 h-24 brightness-0 invert object-contain" alt="Logo">
                <div class="text-center md:text-left">
                    <h3 class="font-heavy text-xl tracking-wide mb-2">Musholla Raudhatul Jannah</h3>
                    <a href="https://maps.app.goo.gl/7QFZ1CJjUiJLDudq9?g_st=ic" target="_blank" aria-label="Lokasi Musholla di Google Maps" class="text-xs text-gray-400 leading-relaxed font-medium hover:text-white transition-colors">
                        Perumahan Grand Permata Tembalang<br>
                        Kelurahan Rowosari, Kecamatan Tembalang,<br>
                        Kota Semarang, Jawa Tengah 50279
                    </a>
                </div>
            </div>
            
            <div class="flex flex-col gap-6">
                <div class="flex items-center gap-6 bg-white/5 p-6 rounded-[2.5rem] border border-white/5">
                    <div class="text-right">
                        <p class="text-[11px] text-gray-400 tracking-wider mb-1">Informasi Seputar</p>
                        <p class="text-base font-bold text-white leading-tight">Infaq dan Sedekah<br>Silakan klik:</p>
                    </div>
                    <a href="https://wa.me/6289660304009?text=BTPN%20SYARIAH%20%28547%29%0A1023862413%0AWILDAN%20BACHTIAR" target="_blank" class="bg-white p-2 rounded-2xl w-24 h-24 hover:scale-105 transition-transform flex items-center justify-center shadow-xl">
                        <img src="qr-code.svg" class="w-full h-full" alt="Scan QR Code">
                    </a>
                </div>
                <div class="flex flex-col gap-3 px-2">
                    <a href="https://docs.google.com/spreadsheets/d/1Zjk4UNAZi_My_kTvD5QbPO7LS47p6Y_L3ppK_tRyEfc/edit?usp=sharing" target="_blank" title="Buka Laporan Keuangan" class="group flex items-center gap-3 text-xs text-gray-400 hover:text-white transition-colors">
                        <span class="text-green-500 group-hover:translate-x-1 transition-transform">➤</span>
                        <span class="border-b border-transparent group-hover:border-gray-500">Laporan Keuangan Musholla</span>
                    </a>
                    <a href="https://renovasimushollagpt.my.canva.site/" target="_blank" title="Buka Laporan Keuangan" class="group flex items-center gap-3 text-xs text-gray-400 hover:text-white transition-colors">
                        <span class="text-green-500 group-hover:translate-x-1 transition-transform">➤</span>
                        <span class="border-b border-transparent group-hover:border-gray-500">Laporan Keuangan Renovasi Musholla</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="fixed bottom-6 right-6 z-[60] flex items-center group">
        <span class="mr-3 bg-[#16a34a] text-white text-xs font-bold px-4 py-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-lg pointer-events-none">Arah Kiblat</span>
        <button onclick="bukaKiblat()" aria-label="Buka Kompas Arah Kiblat" class="w-14 h-14 bg-[#16a34a] rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all border-4 border-white/10">
            <img src="icon-kiblat.svg" class="w-7 h-7 invert" alt="Kiblat">
        </button>
    </div>

    <div id="modal-kiblat" class="fixed inset-0 z-[200] hidden items-center justify-center p-6 transition-all">
        <div class="absolute inset-0 bg-black/70 backdrop-blur-md" onclick="tutupKiblat()"></div>
        <div class="bg-[#1a1a1a] w-full max-w-sm rounded-[3rem] p-8 relative z-[210] text-center text-white border border-white/5 shadow-2xl">
            <button onclick="tutupKiblat()" class="absolute top-6 right-8 text-white/30 hover:text-white text-2xl transition-colors">&times;</button>
        
            <h3 class="text-xl font-heavy mb-2 mt-4 tracking-tight">Arah Kiblat</h3>
            <p class="text-xs text-gray-400 mb-12">Putar ponsel perlahan hingga gambar Ka'bah tegak lurus</p>

            <div class="relative w-72 h-72 mx-auto mb-16 flex items-center justify-center">
            
                <div class="absolute -top-7 left-1/2 -translate-x-1/2 w-1 h-5 bg-white/20 rounded-full z-10"></div>

                <div id="kompas-disk" class="w-full h-full rounded-full relative transition-transform duration-100 ease-linear flex items-center justify-center bg-[#262626] border border-white/5 shadow-inner">
                
                    <div class="absolute inset-0 rounded-full flex items-center justify-center">
                        <span class="absolute top-2 font-bold text-white text-[10px]">0°</span>
                        <span class="absolute right-2 font-bold text-white text-[10px]">90°</span>
                        <span class="absolute bottom-2 font-bold text-white text-[10px]">180°</span>
                        <span class="absolute left-2 font-bold text-white text-[10px]">270°</span>
                    
                        <style>
                            .deg-marker { position: absolute; height: 92%; width: 20px; display: flex; justify-content: center; align-items: flex-start; font-size: 8px; color: #4b5563; pointer-events: none; }
                            .deg-30 { transform: rotate(30deg); } .deg-30 span { transform: rotate(-30deg); }
                            .deg-60 { transform: rotate(60deg); } .deg-60 span { transform: rotate(-60deg); }
                            .deg-120 { transform: rotate(120deg); } .deg-120 span { transform: rotate(-120deg); }
                            .deg-150 { transform: rotate(150deg); } .deg-150 span { transform: rotate(-150deg); }
                            .deg-210 { transform: rotate(210deg); } .deg-210 span { transform: rotate(-210deg); }
                            .deg-240 { transform: rotate(240deg); } .deg-240 span { transform: rotate(-240deg); }
                            .deg-300 { transform: rotate(300deg); } .deg-300 span { transform: rotate(-300deg); }
                            .deg-330 { transform: rotate(330deg); } .deg-330 span { transform: rotate(-330deg); }
                        </style>
                        <div class="deg-marker deg-30"><span>30°</span></div>
                        <div class="deg-marker deg-60"><span>60°</span></div>
                        <div class="deg-marker deg-120"><span>120°</span></div>
                        <div class="deg-marker deg-150"><span>150°</span></div>
                        <div class="deg-marker deg-210"><span>210°</span></div>
                        <div class="deg-marker deg-240"><span>240°</span></div>
                        <div class="deg-marker deg-300"><span>300°</span></div>
                        <div class="deg-marker deg-330"><span>330°</span></div>
                    </div>

                    <div class="absolute w-[78%] h-[78%] rounded-full bg-[#121212] shadow-2xl flex items-center justify-center overflow-hidden">
                        <div class="absolute inset-0 text-2xl font-black text-white p-4">
                            <span class="absolute top-2 left-1/2 -translate-x-1/2 text-red-600">U</span>
                            <span class="absolute top-1/2 right-4 -translate-y-1/2">T</span>
                            <span class="absolute bottom-2 left-1/2 -translate-x-1/2">S</span>
                            <span class="absolute top-1/2 left-4 -translate-y-1/2">B</span>
                        </div>

                        <div class="w-[58%] h-[58%] rounded-full flex items-center justify-center relative" 
                             style="background: linear-gradient(135deg, #FFD700 0%, #FDB931 25%, #E39600 50%, #B5840D 75%, #8A6614 100%); shadow: 0 0 30px rgba(212,175,55,0.3);">
                        </div>
                    </div>

                    <div id="wrapper-kiblat" class="absolute inset-0 z-50 pointer-events-none" style="transform: rotate(295deg);">
                        <div class="absolute -top-6 left-1/2 -translate-x-1/2">
                            <div class="w-0 h-0 border-l-[12px] border-l-transparent border-r-[12px] border-r-transparent border-b-[24px] border-b-red-600 drop-shadow-[0_0_15px_rgba(220,38,38,0.8)]"></div>
                        </div>
                    
                        <div class="absolute inset-0 flex items-center justify-center">
                            <img src="Ka'bah.webp" class="w-[25%] object-contain drop-shadow-2xl" style="transform: translateY(-2px);" alt="Ka'bah">
                        </div>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-3xl p-5 flex items-center justify-between shadow-xl">
                <div class="flex items-center gap-4">
                    <div class="p-2.5 rounded-2xl flex items-center justify-center" 
                         style="background: linear-gradient(135deg, #FFD700 0%, #E39600 100%);">
                        <img src="icon-kiblat.svg" class="w-6 h-6 brightness-0 invert" alt="Kiblat">
                    </div>
                    <span class="text-gray-800 font-bold text-base">Posisi Kiblat</span>
                </div>
                <div class="flex items-center gap-3">
                    <div class="w-px h-8 bg-gray-200"></div>
                    <span id="derajat-teks" class="text-red-600 text-3xl font-heavy">295°</span>
                </div>
            </div>
        </div>
    </div>
    <div id="modal-lokasi" class="fixed inset-0 z-[250] hidden items-center justify-center p-6">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="tutupModalLokasi()"></div>
    <div class="bg-[#1a1a1a] w-full max-w-sm rounded-[2.5rem] p-8 relative z-[260] text-white border border-white/10 shadow-2xl">
        <h3 class="text-xl font-heavy mb-6 text-center">Pilih Lokasi</h3>
        <div class="flex flex-col gap-4">
            <button onclick="getUserLocation()" class="w-full bg-green-600 hover:bg-green-700 py-4 rounded-2xl font-bold transition-all flex items-center justify-center gap-2">
                Lokasi Terkini
            </button>
            <button onclick="bukaCariKota()" class="w-full bg-white/5 hover:bg-white/10 border border-white/10 py-4 rounded-2xl font-bold transition-all">
                Pilih Lokasi
            </button>
        </div>
    </div>
</div>

<div id="modal-cari-kota" class="fixed inset-0 z-[270] hidden items-center justify-center p-6">
    <div class="absolute inset-0 bg-black/80 backdrop-blur-md" onclick="tutupCariKota()"></div>
    <div class="bg-[#1a1a1a] w-full max-w-md h-[500px] rounded-[2.5rem] flex flex-col relative z-[280] text-white border border-white/10 overflow-hidden">
        <div class="p-6 border-b border-white/5">
            <div class="relative">
                <input type="text" id="input-cari" onkeyup="filterKota()" placeholder="Cari lokasi..." class="w-full bg-white/5 border border-white/10 rounded-2xl py-4 pl-12 pr-4 text-white focus:outline-none focus:border-green-500 transition-all text-sm">
    
                <div class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 opacity-40 pointer-events-none">
                    <svg focusable="false" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="white">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"></path>
                    </svg>
                </div>
            </div>
        </div>
        <div id="daftar-kota" class="flex-1 overflow-y-auto p-4 flex flex-col items-center justify-center text-center opacity-30">
    
           <svg class="w-20 h-20 mb-4" viewBox="0 0 52 52" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                <path d="M13.2,25.183c-2.03,-2.64 -3.237,-5.944 -3.237,-9.529c0,-8.64 7.014,-15.654 15.654,-15.654c8.64,0 15.654,7.014 15.654,15.654c0,3.584 -1.207,6.889 -3.237,9.529c-2.329,3.384 -4.331,4.857 -6.126,6.536c-1.22,1.14 -2.795,2.885 -3.569,4.56c-0.795,1.72 0.06,5.212 -2.722,5.212c-2.782,0 -1.927,-3.492 -2.722,-5.212c-0.775,-1.675 -2.35,-3.42 -3.569,-4.56c-1.796,-1.679 -3.797,-3.151 -6.126,-6.536Zm12.417,-13.568c-2.229,0 -4.039,1.81 -4.039,4.039c0,2.229 1.81,4.039 4.039,4.039c2.229,0 4.039,-1.81 4.039,-4.039c0,-2.229 -1.81,-4.039 -4.039,-4.039Z"/>
                <path d="M36.662,32.302c4.719,0.832 8.584,2.168 11.011,3.766c2.404,1.583 3.561,3.517 3.561,5.422c0,1.905 -1.157,3.839 -3.561,5.422c-4.138,2.725 -12.454,4.688 -22.056,4.688c-9.602,0 -17.918,-1.963 -22.056,-4.688c-2.404,-1.583 -3.561,-3.517 -3.561,-5.422c0,-1.905 1.157,-3.839 3.561,-5.422c2.428,-1.598 6.293,-2.935 11.012,-3.766c0.791,0.74 1.545,1.391 2.272,2.071c0.459,0.429 0.994,0.963 1.489,1.547c-4.384,0.501 -8.159,1.447 -10.846,2.698c-1.164,0.542 -2.103,1.126 -2.737,1.777c-0.348,0.357 -0.613,0.699 -0.613,1.096c0,0.397 0.265,0.739 0.613,1.096c0.635,0.65 1.574,1.235 2.737,1.777c4.088,1.904 10.692,3.1 18.129,3.1c7.437,0 14.041,-1.196 18.129,-3.1c1.164,-0.542 2.103,-1.126 2.737,-1.777c0.348,-0.357 0.613,-0.699 0.613,-1.096c0,-0.397 -0.265,-0.739 -0.613,-1.096c-0.635,-0.65 -1.574,-1.235 -2.737,-1.777c-2.687,-1.252 -6.462,-2.197 -10.846,-2.698c0.495,-0.584 1.03,-1.118 1.489,-1.547c0.727,-0.679 1.481,-1.331 2.272,-2.071Z" opacity="0.6"/>
            </svg>

            <p class="text-xs tracking-widest text-white">
                Cari Kota atau Kabupaten<br>untuk melihat jadwal
            </p>
        </div>
    </div>
</div>

<script>
    let viewDate = new Date(); 
    let lat = -7.0503, lon = 110.4398; // Koordinat Default Tembalang
    let todayTimings = null, tomorrowTimings = null;
    let intervalId = null, qiblaAngle = 295;
    let sudahNotif = "";

    const bulanHijriahKBBI = {
        "Muḥarram": "Muharam", "Ṣafar": "Safar", "Rabīʿ al-awwal": "Rabiulawal", 
        "Rabīʿ al-thānī": "Rabiulakhir", "Jumādá al-ūlá": "Jumadilawal", 
        "Jumādá al-ākhirah": "Jumadilakhir", "Rajab": "Rajab", "Shaʿbān": "Syakban", 
        "Ramaḍān": "Ramadan", "Shawwāl": "Syawal", "Dhū al-Qaʿdah": "Zulkaidah", "Dhū al-Ḥijjah": "Zulhijah"
    };
    const namaHariMap = ["Ahad", "Senin", "Selasa", "Rabu", "Kamis", "Jumat", "Sabtu"];

    // --- LOGIKA JADWAL SALAT ---
    function tampilkanToast(nama) {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        toast.className = "bg-white/95 backdrop-blur-md border border-gray-100 shadow-2xl rounded-[1.5rem] p-4 flex items-center justify-between gap-6 transform translate-y-[-20px] opacity-0 transition-all duration-500 ease-out mb-3";
        toast.innerHTML = `
            <div class="flex items-center gap-4">
                <div class="bg-green-50 p-2.5 rounded-2xl">
                    <img src="icon-${nama.toLowerCase()}.svg" class="w-6 h-6" style="filter: invert(40%) sepia(87%) saturate(1518%) hue-rotate(117deg) brightness(93%) contrast(85%);">
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-bold text-gray-700 leading-none tracking-tight">
                        Waktu <span class="text-green-600 uppercase font-heavy">${nama}</span> Telah Tiba
                    </span>
                </div>
            </div>
            <button onclick="this.parentElement.remove()" class="bg-green-600 hover:bg-green-700 text-white text-[10px] font-heavy px-4 py-2 rounded-xl transition-colors shadow-sm active:scale-95 uppercase">OKE</button>
        `;
        container.appendChild(toast);
        setTimeout(() => toast.classList.remove('opacity-0', 'translate-y-[-20px]'), 100);
        setTimeout(() => { if(toast.parentElement) toast.remove(); }, 60000);
    }

    function ubahHari(n) {
        viewDate.setDate(viewDate.getDate() + n);
        fetchJadwal();
    }

    function geserWaktu(waktuAsli, menit) {
        let [h, m] = waktuAsli.split(':').map(Number);
        let d = new Date(); d.setHours(h, m, 0); d.setMinutes(d.getMinutes() + menit);
        return String(d.getHours()).padStart(2, '0') + ":" + String(d.getMinutes()).padStart(2, '0');
    }

    function fetchJadwal() {
        const ts = Math.floor(viewDate.getTime() / 1000);
        const tmrw = new Date(viewDate); tmrw.setDate(tmrw.getDate() + 1);
        const tmrwTs = Math.floor(tmrw.getTime() / 1000);
        const tune = "0,3,-3,3,4,3,0,2"; 

        Promise.all([
            fetch(`https://api.aladhan.com/v1/timings/${ts}?latitude=${lat}&longitude=${lon}&method=20&tune=${tune}`).then(r => r.json()),
            fetch(`https://api.aladhan.com/v1/timings/${tmrwTs}?latitude=${lat}&longitude=${lon}&method=20&tune=${tune}`).then(r => r.json())
        ]).then(([d1, d2]) => {
            let t = d1.data.timings;
            const h = d1.data.date.hijri;
            t.Imsak = geserWaktu(t.Fajr, -10);
            t.Duha = geserWaktu(t.Sunrise, 28); 

            if (viewDate.toDateString() === new Date().toDateString()) {
                todayTimings = t; 
                tomorrowTimings = d2.data.timings;
                tomorrowTimings.Imsak = geserWaktu(tomorrowTimings.Fajr, -10);
                initRealtimeCountdown();
            }

            document.getElementById('display-hari').innerText = namaHariMap[viewDate.getDay()];
            const hBulan = h.month.en; 
            const hStr = `${h.day} ${bulanHijriahKBBI[hBulan] || hBulan} ${h.year} H`;
            document.getElementById('display-hijri').innerText = hStr;
            document.getElementById('display-masehi').innerText = viewDate.toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' }) + " M";
            document.getElementById('sticky-realtime-info').innerText = `${namaHariMap[viewDate.getDay()]}, ${hStr}`;

            const list = ['Imsak', 'Subuh', 'Terbit', 'Duha', 'Zuhur', 'Asar', 'Magrib', 'Isya'];
            const apiMap = { 'Imsak':'Imsak','Subuh':'Fajr','Terbit':'Sunrise','Duha':'Duha','Zuhur':'Dhuhr','Asar':'Asr','Magrib':'Maghrib','Isya':'Isha' };

            list.forEach(k => {
                document.getElementById(`v-${k}`).innerText = t[apiMap[k]];
                const c = document.getElementById(`card-${k}`);
                c.className = "card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border border-gray-50 transition-all duration-500";
                const ic = document.getElementById(`icon-${k}`);
                ic.style.filter = "none"; ic.className = "w-10 h-10 mb-5 opacity-20";
                c.querySelector('.label').className = "text-[10px] font-heavy text-gray-400 uppercase tracking-[0.2em] label mb-2";
                c.querySelector('.time').className = "text-3xl font-heavy text-gray-700 time tracking-tight";
            });
        });
    }

    function initRealtimeCountdown() {
        if (intervalId) clearInterval(intervalId);
        intervalId = setInterval(() => {
            if (!todayTimings) return;
            const now = new Date();
            const times = [
                { name: 'Imsak', time: todayTimings.Imsak }, { name: 'Subuh', time: todayTimings.Fajr },
                { name: 'Zuhur', time: todayTimings.Dhuhr }, { name: 'Asar', time: todayTimings.Asr },
                { name: 'Magrib', time: todayTimings.Maghrib }, { name: 'Isya', time: todayTimings.Isha }
            ];

            const curHM = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
            times.forEach(p => {
                if (curHM === p.time && sudahNotif !== p.name) {
                    tampilkanToast(p.name); sudahNotif = p.name;
                }
            });

            let next = null;
            for (let p of times) {
                let pt = new Date(); let [h, m] = p.time.split(':'); pt.setHours(h, m, 0);
                if (pt > now) { next = { ...p, obj: pt }; break; }
            }
            if (!next) {
                let pt = new Date(); pt.setDate(pt.getDate()+1);
                let [h, m] = tomorrowTimings.Imsak.split(':'); pt.setHours(h, m, 0);
                next = { name: 'Imsak', time: tomorrowTimings.Imsak, obj: pt };
            }
            
            document.getElementById('next-pray-name').innerText = next.name;
            document.getElementById('next-pray-time').innerText = next.time;
            let diff = next.obj - now;
            let hh = Math.floor(diff / 3600000); let mm = Math.floor((diff % 3600000) / 60000); let ss = Math.floor((diff % 60000) / 1000);
            document.getElementById('countdown').innerText = `-${String(hh).padStart(2,'0')}:${String(mm).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;

            if (viewDate.toDateString() === new Date().toDateString()) {
                const active = document.getElementById(`card-${next.name}`);
                if(active) {
                    active.className = "card-soft-shadow bg-white rounded-[2.5rem] p-8 flex flex-col items-center justify-center text-center h-48 border-2 border-green-500 shadow-xl scale-[1.05] z-20";
                    active.querySelector('.label').className = "text-[10px] font-heavy text-green-600 uppercase tracking-[0.2em] label mb-2";
                    active.querySelector('.time').className = "text-3xl font-heavy text-green-600 time tracking-tight";
                    const ic = document.getElementById(`icon-${next.name}`);
                    ic.className = "w-10 h-10 mb-5 opacity-100";
                    ic.style.filter = "invert(40%) sepia(87%) saturate(1518%) hue-rotate(117deg) brightness(93%) contrast(85%)";
                }
            }
        }, 1000);
    }

    // --- LOGIKA KIBLAT ---
    function hitungKiblat(lati, longi) {
        const phiK = 21.4225 * Math.PI / 180; const lamK = 39.8262 * Math.PI / 180;
        const phiL = lati * Math.PI / 180; const lamL = longi * Math.PI / 180;
        const y = Math.sin(lamK - lamL);
        const x = Math.cos(phiL) * Math.tan(phiK) - Math.sin(phiL) * Math.cos(lamK - lamL);
        return (Math.atan2(y, x) * 180 / Math.PI + 360) % 360;
    }

    function bukaKiblat() {
        const modal = document.getElementById('modal-kiblat');
        modal.classList.remove('hidden'); modal.classList.add('flex');
        qiblaAngle = hitungKiblat(lat, lon);
        document.getElementById('derajat-teks').innerText = Math.round(qiblaAngle) + "°";

        if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
            DeviceOrientationEvent.requestPermission().then(state => { if (state === 'granted') aktifkanKompas(); }).catch(console.error);
        } else { aktifkanKompas(); }
    }

    function aktifkanKompas() {
        if ("ondeviceorientationabsolute" in window) {
            window.addEventListener('deviceorientationabsolute', handlerKompas, true);
        } else {
            window.addEventListener('deviceorientation', handlerKompas, true);
        }
    }

    function handlerKompas(e) {
        let compass = e.webkitCompassHeading || (360 - e.alpha);
        if (compass !== null && compass !== undefined) {
            document.getElementById('kompas-disk').style.transform = `rotate(${-compass}deg)`;
        }
    }

    function tutupKiblat() {
        document.getElementById('modal-kiblat').classList.add('hidden');
        document.getElementById('modal-kiblat').classList.remove('flex');
        window.removeEventListener('deviceorientationabsolute', handlerKompas);
        window.removeEventListener('deviceorientation', handlerKompas);
    }

    function updateKiblat(lat, lng) {
        const latKabah = 21.4225;
        const lngKabah = 39.8262;
    
        const phi1 = lat * Math.PI / 180;
        const phi2 = latKabah * Math.PI / 180;
        const deltaL = (lngKabah - lng) * Math.PI / 180;
    
        const y = Math.sin(deltaL);
        const x = Math.cos(phi1) * Math.tan(phi2) - Math.sin(phi1) * Math.cos(deltaL);
        let kiblat = Math.atan2(y, x) * 180 / Math.PI;
        kiblat = (kiblat + 360) % 360;

        document.getElementById('wrapper-kiblat').style.transform = `rotate(${kiblat}deg)`;
        document.getElementById('derajat-teks').innerText = Math.round(kiblat) + '°';
    }

// Panggil fungsi ini saat mendapatkan lokasi GPS
// updateKiblat(lat_user, lng_user);

    // --- INISIALISASI ---
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            lat = p.coords.latitude; lon = p.coords.longitude;
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`)
                .then(r => r.json()).then(d => {
                    const kotaKab = d.address.city || d.address.regency || d.address.municipality || "Kota Semarang";
                    document.getElementById('display-lokasi').innerText = kotaKab;
                    document.getElementById('sticky-location').innerText = kotaKab;
                    fetchJadwal();
                }).catch(() => fetchJadwal());
        }, () => fetchJadwal());
    } else { fetchJadwal(); }

    window.onscroll = function() {
        const header = document.getElementById('sticky-header');
        if (window.scrollY > 580) { header.classList.remove('-translate-y-full'); header.classList.add('translate-y-0'); }
        else { header.classList.remove('translate-y-0'); header.classList.add('-translate-y-full'); }
    };
    // Script Efek Parallax & Zoom Out
    window.addEventListener('scroll', function() {
        const bg = document.getElementById('parallax-bg');
        let scrollPos = window.pageYOffset;
        
        if (scrollPos <= 500) { 
            let yPos = scrollPos * 0.3;
            
            let zoom = 1.05 - (scrollPos / 8000);
            
            bg.style.transform = `translateY(${yPos}px) scale(${Math.max(zoom, 1)})`;
        }
    });

    function bukaModalLokasi() { document.getElementById('modal-lokasi').classList.replace('hidden', 'flex'); }
    function tutupModalLokasi() { document.getElementById('modal-lokasi').classList.replace('flex', 'hidden'); }

    function bukaCariKota() {
        tutupModalLokasi();
        document.getElementById('modal-cari-kota').classList.replace('hidden', 'flex');
        document.getElementById('input-cari').focus();
    }
    function tutupCariKota() { document.getElementById('modal-cari-kota').classList.replace('flex', 'hidden'); }

    // Fungsi mencari koordinat berdasarkan input
    async function filterKota() {
        const query = document.getElementById('input-cari').value;
        if (query.length < 3) return;

    // Mencari lokasi di Indonesia
        const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${query}&countrycodes=id&limit=5`);
        const data = await response.json();
    
        const container = document.getElementById('daftar-kota');
        container.innerHTML = data.map(item => `
            <button onclick="pilihLokasiManual(${item.lat}, ${item.lon}, '${item.display_name}')" class="text-left p-4 hover:bg-white/5 rounded-xl border-b border-white/5 transition-all">
                <p class="text-sm font-bold text-white">${item.display_name.split(',')[0]}</p>
                <p class="text-[10px] text-gray-500 truncate">${item.display_name}</p>
            </button>
        `).join('');
    }

function pilihLokasiManual(newLat, newLon, fullName) {
    lat = newLat; lon = newLon;
    const shortName = fullName.split(',')[0];
    document.getElementById('display-lokasi').innerText = shortName;
    document.getElementById('sticky-location').innerText = shortName;
    
    tutupCariKota();
    fetchJadwal(); // Refresh jadwal tanpa reload halaman
}

// Fungsi GPS yang dipanggil ulang
function getUserLocation() {
    tutupModalLokasi();
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(p => {
            lat = p.coords.latitude; lon = p.coords.longitude;
            fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=10`)
                .then(r => r.json()).then(d => {
                    const kota = d.address.city || d.address.regency || "Lokasi GPS";
                    document.getElementById('display-lokasi').innerText = kota;
                    document.getElementById('sticky-location').innerText = kota;
                    fetchJadwal();
                });
        });
    }
}
</script>
</body>
</html>